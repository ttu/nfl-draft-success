#!/bin/sh
set -e

echo "ğŸ” Running pre-push validation..."

# Check if branch is rebased on latest main
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Skip check for main branch
if [ "$current_branch" != "main" ]; then
  echo "ğŸ“‹ Checking if branch is rebased on main..."

  # Fetch latest main (silently)
  git fetch origin main --quiet 2>/dev/null || true

  # Check if origin/main is an ancestor of current branch
  if ! git merge-base --is-ancestor origin/main HEAD 2>/dev/null; then
    echo "âŒ Error: Your branch is not rebased on the latest main."
    echo ""
    echo "Please rebase your branch:"
    echo "  git fetch origin main"
    echo "  git rebase origin/main"
    exit 1
  fi

  echo "âœ… Branch is up-to-date with main"
fi

echo "âœ… Pre-push validation passed!"
